<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Tailscale Session Recorder Architecture | Claude Diagrams</title>
<meta name=generator content="Hugo 0.121.2"><link rel=stylesheet href=/claude-diagrams/css/main.min.6031f18919a5919243f3aef7c58df672be3052a45dd4517b8fc728761fda4de4.css></head><body><main><article class=diagram-single><header class=diagram-header><h1>Tailscale Session Recorder Architecture</h1><p class=description>Comprehensive diagram showing how Tailscale SSH session recording works, including data flow, components, and storage options</p><div class=metadata><time>January 24, 2025</time><div class=tags><a href=/claude-diagrams/tags/tailscale/ class=tag>#tailscale</a>
<a href=/claude-diagrams/tags/ssh/ class=tag>#ssh</a>
<a href=/claude-diagrams/tags/session-recording/ class=tag>#session-recording</a>
<a href=/claude-diagrams/tags/security/ class=tag>#security</a>
<a href=/claude-diagrams/tags/compliance/ class=tag>#compliance</a>
<a href=/claude-diagrams/tags/tsrecorder/ class=tag>#tsrecorder</a>
<a href=/claude-diagrams/tags/asciinema/ class=tag>#asciinema</a></div></div></header><div class=diagram-container><div class=svg-wrapper><svg viewBox="0 0 1500 900" xmlns="http://www.w3.org/2000/svg"><defs><linearGradient id="blueGradient" x1="0" y1="0" x2="100%" y2="100%"><stop offset="0" style="stop-color:#2196f3;stop-opacity:1"/><stop offset="100%" style="stop-color:#1976d2;stop-opacity:1"/></linearGradient><linearGradient id="greenGradient" x1="0" y1="0" x2="100%" y2="100%"><stop offset="0" style="stop-color:#4caf50;stop-opacity:1"/><stop offset="100%" style="stop-color:#388e3c;stop-opacity:1"/></linearGradient><linearGradient id="orangeGradient" x1="0" y1="0" x2="100%" y2="100%"><stop offset="0" style="stop-color:#ff9800;stop-opacity:1"/><stop offset="100%" style="stop-color:#f57c00;stop-opacity:1"/></linearGradient><filter id="shadow" x="-50%" y="-50%" width="200%" height="200%"><feGaussianBlur in="SourceAlpha" stdDeviation="3"/><feOffset dx="2" dy="2" result="offsetblur"/><feComponentTransfer><feFuncA type="linear" slope=".2"/></feComponentTransfer><feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge></filter><g id="userIcon"><circle cx="12" cy="8" r="4" fill="currentcolor"/><path d="M12 14c-4 0-8 2-8 6h16c0-4-4-6-8-6z" fill="currentcolor"/></g><g id="serverIcon"><rect x="4" y="4" width="16" height="4" rx="1" fill="currentcolor"/><rect x="4" y="10" width="16" height="4" rx="1" fill="currentcolor"/><rect x="4" y="16" width="16" height="4" rx="1" fill="currentcolor"/><circle cx="18" cy="6" r="1" fill="#4caf50"/><circle cx="18" cy="12" r="1" fill="#4caf50"/><circle cx="18" cy="18" r="1" fill="#4caf50"/></g><g id="recorderIcon"><circle cx="12" cy="12" r="8" fill="none" stroke="currentcolor" stroke-width="2"/><circle cx="12" cy="12" r="3" fill="#f44336"/><rect x="11" y="2" width="2" height="4" fill="currentcolor"/><rect x="11" y="18" width="2" height="4" fill="currentcolor"/><rect x="2" y="11" width="4" height="2" fill="currentcolor"/><rect x="18" y="11" width="4" height="2" fill="currentcolor"/></g><g id="storageIcon"><path d="M4 6c0-2 2-4 8-4s8 2 8 4V18c0 2-2 4-8 4s-8-2-8-4z" fill="currentcolor"/><ellipse cx="12" cy="6" rx="8" ry="4" fill="#fff" opacity=".3"/><ellipse cx="12" cy="12" rx="8" ry="4" fill="#fff" opacity=".2"/><ellipse cx="12" cy="18" rx="8" ry="4" fill="#fff" opacity=".1"/></g><g id="lockIcon"><rect x="8" y="10" width="8" height="7" rx="1" fill="currentcolor"/><path d="M9 10V8c0-2 1-4 3-4s3 2 3 4v2" fill="none" stroke="currentcolor" stroke-width="2"/></g><g id="checkIcon"><circle cx="12" cy="12" r="10" fill="#4caf50"/><path d="M8 12l3 3 5-6" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></g></defs><rect width="1500" height="900" fill="#f5f5f5"/><text x="750" y="60" font-family="Inter, Arial, sans-serif" font-size="36" font-weight="600" text-anchor="middle" fill="#000">Tailscale SSH Session Recording</text><text x="750" y="95" font-family="Inter, Arial, sans-serif" font-size="20" text-anchor="middle" fill="#64748b">Secure, private session recording that you control</text><g transform="translate(50, 150)"><g id="tailnetContainer"><rect x="-20" y="-30" width="1120" height="560" rx="20" fill="none" stroke="#2196f3" stroke-width="3" stroke-dasharray="10,5" opacity=".8"/><rect x="-20" y="-30" width="200" height="40" rx="10" fill="#2196f3"/><text x="80" y="-5" font-family="Inter, Arial, sans-serif" font-size="18" font-weight="600" text-anchor="middle" fill="#fff">Your Tailnet</text><text x="550" y="-5" font-family="Inter, Arial, sans-serif" font-size="16" text-anchor="middle" fill="#2196f3" font-style="italic">All traffic encrypted with WireGuard</text></g><g id="usersSection"><rect x="0" y="0" width="250" height="300" rx="12" fill="#e3f2fd" filter="url(#shadow)"/><text x="125" y="35" font-family="Inter, Arial, sans-serif" font-size="20" font-weight="500" text-anchor="middle" fill="#1976d2">Your Team</text><g transform="translate(25, 70)"><circle cx="40" cy="35" r="30" fill="url(#blueGradient)"/><use href="#userIcon" x="28" y="23" width="24" height="24" fill="#fff"/><text x="40" y="80" font-family="Inter, Arial, sans-serif" font-size="14" text-anchor="middle" fill="#374151">Developer</text></g><g transform="translate(25, 160)"><circle cx="40" cy="35" r="30" fill="url(#blueGradient)"/><use href="#userIcon" x="28" y="23" width="24" height="24" fill="#fff"/><text x="40" y="80" font-family="Inter, Arial, sans-serif" font-size="14" text-anchor="middle" fill="#374151">Admin</text></g><g transform="translate(145, 115)"><circle cx="40" cy="35" r="30" fill="url(#blueGradient)"/><use href="#userIcon" x="28" y="23" width="24" height="24" fill="#fff"/><text x="40" y="80" font-family="Inter, Arial, sans-serif" font-size="14" text-anchor="middle" fill="#374151">Support</text></g></g><g id="sshConnection"><defs><marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto"><polygon points="0 0, 10 3, 0 6" fill="#2196f3"/></marker></defs><path d="M260 150H380" fill="none" stroke="#2196f3" stroke-width="3" stroke-dasharray="5,5" marker-end="url(#arrowhead)"/><g transform="translate(290, 125)"><rect x="0" y="0" width="60" height="60" rx="30" fill="#fff" filter="url(#shadow)"/><use href="#lockIcon" x="18" y="18" width="24" height="24" fill="#2196f3"/></g><text x="320" y="200" font-family="Inter, Arial, sans-serif" font-size="14" text-anchor="middle" fill="#2196f3">Tailscale SSH</text><text x="320" y="215" font-family="Inter, Arial, sans-serif" font-size="12" text-anchor="middle" fill="#64748b">(over WireGuard)</text></g><g id="serversSection" transform="translate(400, 0)"><rect x="0" y="0" width="250" height="300" rx="12" fill="#e8f5e9" filter="url(#shadow)"/><text x="125" y="35" font-family="Inter, Arial, sans-serif" font-size="20" font-weight="500" text-anchor="middle" fill="#388e3c">Your Servers</text><g transform="translate(25, 70)"><rect x="0" y="0" width="200" height="50" rx="8" fill="#fff" filter="url(#shadow)"/><use href="#serverIcon" x="10" y="13" width="24" height="24" fill="#4caf50"/><text x="100" y="30" font-family="Inter, Arial, sans-serif" font-size="14" text-anchor="middle" fill="#374151">Production Server</text></g><g transform="translate(25, 135)"><rect x="0" y="0" width="200" height="50" rx="8" fill="#fff" filter="url(#shadow)"/><use href="#serverIcon" x="10" y="13" width="24" height="24" fill="#4caf50"/><text x="100" y="30" font-family="Inter, Arial, sans-serif" font-size="14" text-anchor="middle" fill="#374151">Database Server</text></g><g transform="translate(25, 200)"><rect x="0" y="0" width="200" height="50" rx="8" fill="#fff" filter="url(#shadow)"/><use href="#serverIcon" x="10" y="13" width="24" height="24" fill="#4caf50"/><text x="100" y="30" font-family="Inter, Arial, sans-serif" font-size="14" text-anchor="middle" fill="#374151">Web Server</text></g></g><g id="recordingFlow"><path d="M525 310v50" fill="none" stroke="#ff9800" stroke-width="3" marker-end="url(#arrowhead)"/><text x="545" y="335" font-family="Inter, Arial, sans-serif" font-size="14" fill="#ff9800">Recording</text><text x="545" y="350" font-family="Inter, Arial, sans-serif" font-size="14" fill="#ff9800">Stream</text></g><g id="recorderSection" transform="translate(400, 380)"><rect x="0" y="0" width="250" height="120" rx="12" fill="#fff3e0" filter="url(#shadow)"/><text x="125" y="35" font-family="Inter, Arial, sans-serif" font-size="20" font-weight="500" text-anchor="middle" fill="#f57c00">Recorder Node</text><g transform="translate(87.5, 50)"><circle cx="37.5" cy="30" r="30" fill="url(#orangeGradient)"/><use href="#recorderIcon" x="25.5" y="18" width="24" height="24" fill="#fff"/></g></g><g id="storageFlow"><path d="M660 440H780" fill="none" stroke="#607d8b" stroke-width="3" marker-end="url(#arrowhead)"/></g><g id="storageSection" transform="translate(800, 380)"><rect x="0" y="0" width="250" height="120" rx="12" fill="#eceff1" filter="url(#shadow)"/><text x="125" y="35" font-family="Inter, Arial, sans-serif" font-size="20" font-weight="500" text-anchor="middle" fill="#455a64">Your Storage</text><g transform="translate(87.5, 50)"><circle cx="37.5" cy="30" r="30" fill="#607d8b"/><use href="#storageIcon" x="25.5" y="18" width="24" height="24" fill="#fff"/></g></g><g id="benefitsSection" transform="translate(1150, 50)"><rect x="0" y="-20" width="180" height="280" rx="12" fill="#f9fafb" filter="url(#shadow)"/><text x="90" y="10" font-family="Inter, Arial, sans-serif" font-size="20" font-weight="500" text-anchor="middle" fill="#000">Benefits</text><g transform="translate(15, 40)"><use href="#checkIcon" x="0" y="0" width="24" height="24"/><text x="30" y="8" font-family="Inter, Arial, sans-serif" font-size="14" fill="#374151">Compliance</text><text x="30" y="22" font-family="Inter, Arial, sans-serif" font-size="14" fill="#374151">Ready</text></g><g transform="translate(15, 75)"><use href="#checkIcon" x="0" y="0" width="24" height="24"/><text x="30" y="8" font-family="Inter, Arial, sans-serif" font-size="14" fill="#374151">Complete</text><text x="30" y="22" font-family="Inter, Arial, sans-serif" font-size="14" fill="#374151">Audit Trail</text></g><g transform="translate(15, 110)"><use href="#checkIcon" x="0" y="0" width="24" height="24"/><text x="30" y="8" font-family="Inter, Arial, sans-serif" font-size="14" fill="#374151">Enhanced</text><text x="30" y="22" font-family="Inter, Arial, sans-serif" font-size="14" fill="#374151">Security</text></g><g transform="translate(15, 145)"><use href="#checkIcon" x="0" y="0" width="24" height="24"/><text x="30" y="8" font-family="Inter, Arial, sans-serif" font-size="14" fill="#374151">Easy Debug</text><text x="30" y="22" font-family="Inter, Arial, sans-serif" font-size="14" fill="#374151">&amp; Support</text></g><g transform="translate(15, 180)"><use href="#checkIcon" x="0" y="0" width="24" height="24"/><text x="30" y="8" font-family="Inter, Arial, sans-serif" font-size="14" fill="#374151">You Own</text><text x="30" y="22" font-family="Inter, Arial, sans-serif" font-size="14" fill="#374151">Your Data</text></g></g></g><g transform="translate(150, 750)"><rect x="0" y="0" width="1100" height="100" rx="12" fill="#f3e5f5" filter="url(#shadow)"/><g transform="translate(40, 25)"><circle cx="25" cy="25" r="25" fill="#9c27b0"/><use href="#lockIcon" x="13" y="13" width="24" height="24" fill="#fff"/></g><text x="100" y="40" font-family="Inter, Arial, sans-serif" font-size="22" font-weight="500" fill="#6a1b9a">Privacy First</text><text x="100" y="70" font-family="Inter, Arial, sans-serif" font-size="18" fill="#374151">Your session recordings never leave your tailnet. Tailscale cannot see or access your data.</text></g><defs><pattern id="diagonalHatch" patternUnits="userSpaceOnUse" width="4" height="4"><path d="M-1 1l2-2M0 4l4-4M3 5l2-2" style="stroke:#e0e0e0;stroke-width:.5"/></pattern></defs><circle cx="1400" cy="200" r="60" fill="url(#diagonalHatch)" opacity=".3"/><circle cx="100" cy="600" r="40" fill="url(#diagonalHatch)" opacity=".3"/><circle cx="1450" cy="500" r="50" fill="url(#diagonalHatch)" opacity=".3"/></svg></div></div><div class=diagram-description><h2 id=overview>Overview</h2><p>This diagram illustrates the architecture and data flow of Tailscale&rsquo;s SSH session recording feature, showing how terminal sessions are captured, streamed, and stored securely within a tailnet.</p><div class=mermaid-wrapper><pre class=mermaid>graph TB
    subgraph "User Workstation"
        U[User] -->|SSH Connection| TC[Tailscale Client]
    end
    
    subgraph "Tailscale SSH Server Node"
        TC -->|WireGuard Tunnel| TS[Tailscale SSH Server]
        TS --> SR[Session Recorder Client]
        SR --> TIO[Terminal I/O Wrapper]
        TIO --> ASC[Asciinema Formatter]
    end
    
    subgraph "Control Plane"
        CP[Coordination Server] -.->|ACL Policy| TS
        CP -.->|Recorder Config| SR
        CP -.->|Node Registry| RN
    end
    
    subgraph "Recorder Infrastructure"
        subgraph "Primary Recorder Node"
            RN[tsrecorder Service]
            RN --> API{API Version}
            API -->|v2| V2[HTTP/2 Handler]
            API -->|v1| V1[HTTP Handler]
            V2 --> ACK[Acknowledgment Stream]
            V2 --> ST[Storage Handler]
            V1 --> ST
        end
        
        subgraph "Storage Backends"
            ST --> FS[Filesystem Backend]
            ST --> S3[S3 Backend]
            FS --> DISK[(Local Disk)]
            S3 --> CLOUD[(S3/R2/B2)]
        end
        
        subgraph "Optional UI"
            WEB[Web UI :443] --> RN
            WEB --> PLAYER[Asciinema Player]
        end
    end
    
    subgraph "Failover Recorder Nodes"
        RN2[Recorder 2] -.->|Failover| ST
        RN3[Recorder 3] -.->|Failover| ST
    end
    
    SR -->|Stream Recording| RN
    SR -.->|If Primary Fails| RN2
    SR -.->|If Secondary Fails| RN3
    
    style U fill:#1976d2,stroke:#fff,stroke-width:2px,color:#fff
    style CP fill:#1976d2,stroke:#fff,stroke-width:2px,color:#fff
    style RN fill:#388e3c,stroke:#fff,stroke-width:2px,color:#fff
    style CLOUD fill:#f57c00,stroke:#fff,stroke-width:2px,color:#fff
    style DISK fill:#455a64,stroke:#fff,stroke-width:2px,color:#fff
  </pre></div><style>.mermaid-wrapper{background:#2a2a2a;border-radius:8px;padding:2rem;margin:1rem 0;overflow-x:auto}.mermaid{text-align:center;background:0 0}.mermaid svg{max-width:100%;height:auto}</style><h2 id=data-flow-sequence>Data Flow Sequence</h2><div class=mermaid-wrapper><pre class=mermaid>sequenceDiagram
    participant User
    participant SSH Server
    participant Recorder Client
    participant tsrecorder
    participant Storage
    
    User->>SSH Server: SSH Connection Request
    SSH Server->>SSH Server: Check ACL Policy
    
    alt Recording Required
        SSH Server->>Recorder Client: Start Recording
        Recorder Client->>tsrecorder: Probe v2 Support (HEAD /v2/record)
        tsrecorder-->>Recorder Client: HTTP 200 (v2 supported)
        
        Recorder Client->>tsrecorder: POST /v2/record (HTTP/2)
        Note over Recorder Client,tsrecorder: Send Asciinema Header
        tsrecorder->>Storage: Initialize Recording
        
        loop Session Active
            SSH Server->>Recorder Client: Terminal Output
            Recorder Client->>Recorder Client: Format as Asciinema
            Recorder Client->>tsrecorder: Stream Data
            tsrecorder->>Storage: Write Data
            
            alt Every 5 seconds (v2)
                tsrecorder-->>Recorder Client: Acknowledgment Frame
            end
        end
        
        User->>SSH Server: Exit Session
        Recorder Client->>tsrecorder: Close Stream
        tsrecorder->>Storage: Finalize Recording
    else Recording Not Required
        SSH Server->>User: Normal SSH Session
    end
  </pre></div><style>.mermaid-wrapper{background:#2a2a2a;border-radius:8px;padding:2rem;margin:1rem 0;overflow-x:auto}.mermaid{text-align:center;background:0 0}.mermaid svg{max-width:100%;height:auto}</style><h2 id=recording-format-structure>Recording Format Structure</h2><div class=mermaid-wrapper><pre class=mermaid>graph LR
    subgraph "Asciinema v2 Format"
        H[Header JSON] --> |Contains| M[Metadata]
        M --> W[Width/Height]
        M --> T[Timestamp]
        M --> N[Node Info]
        M --> U[User Details]
        
        B[Body Lines] --> |Contains| E[Events]
        E --> TS[Timestamp]
        E --> ET[Event Type]
        E --> ED[Event Data]
    end
    
    style H fill:#1976d2,stroke:#fff,stroke-width:2px,color:#fff
    style B fill:#388e3c,stroke:#fff,stroke-width:2px,color:#fff
  </pre></div><style>.mermaid-wrapper{background:#2a2a2a;border-radius:8px;padding:2rem;margin:1rem 0;overflow-x:auto}.mermaid{text-align:center;background:0 0}.mermaid svg{max-width:100%;height:auto}</style><h2 id=acl-configuration-flow>ACL Configuration Flow</h2><div class=mermaid-wrapper><pre class=mermaid>graph TD
    A[SSH Access Rule] --> B{Recording Config?}
    B -->|Yes| C[recorders: tag:recorder]
    B -->|No| D[No Recording]
    
    C --> E{enforceRecorder?}
    E -->|true| F[Fail Closed]
    E -->|false| G[Fail Open]
    
    F --> H[Reject if Recording Fails]
    G --> I[Allow Even if Recording Fails]
    
    style A fill:#1976d2,stroke:#fff,stroke-width:2px,color:#fff
    style F fill:#d32f2f,stroke:#fff,stroke-width:2px,color:#fff
    style G fill:#f57c00,stroke:#fff,stroke-width:2px,color:#fff
  </pre></div><style>.mermaid-wrapper{background:#2a2a2a;border-radius:8px;padding:2rem;margin:1rem 0;overflow-x:auto}.mermaid{text-align:center;background:0 0}.mermaid svg{max-width:100%;height:auto}</style><h2 id=storage-backend-options>Storage Backend Options</h2><div class=mermaid-wrapper><pre class=mermaid>graph TD
    R[tsrecorder] --> SH{Storage Handler}
    
    SH --> FS[Filesystem Backend]
    SH --> S3[S3 Backend]
    
    FS --> FP[File Path Structure]
    FP --> |Format| FSS[basePath/NodeID/timestamp.cast]
    
    S3 --> S3C{S3 Provider}
    S3C --> AWS[AWS S3]
    S3C --> CF[Cloudflare R2]
    S3C --> BB[Backblaze B2]
    S3C --> GCS[Google Cloud Storage]
    S3C --> MIN[MinIO]
    
    style R fill:#388e3c,stroke:#fff,stroke-width:2px,color:#fff
    style AWS fill:#f57c00,stroke:#fff,stroke-width:2px,color:#fff
    style CF fill:#f57c00,stroke:#fff,stroke-width:2px,color:#fff
  </pre></div><style>.mermaid-wrapper{background:#2a2a2a;border-radius:8px;padding:2rem;margin:1rem 0;overflow-x:auto}.mermaid{text-align:center;background:0 0}.mermaid svg{max-width:100%;height:auto}</style><h2 id=failure-handling-states>Failure Handling States</h2><div class=mermaid-wrapper><pre class=mermaid>stateDiagram-v2
    [*] --> Connecting: SSH Session Start
    Connecting --> CheckPolicy: Validate ACL
    
    CheckPolicy --> NoRecording: Recording Not Required
    CheckPolicy --> FindRecorder: Recording Required
    
    FindRecorder --> TryPrimary: Get Recorder IPs
    TryPrimary --> Connected: Success
    TryPrimary --> TryFailover: Connection Failed
    
    TryFailover --> Connected: Failover Success
    TryFailover --> RecordingFailed: All Recorders Down
    
    RecordingFailed --> SessionRejected: enforceRecorder=true
    RecordingFailed --> SessionAllowed: enforceRecorder=false
    
    Connected --> Streaming: Start Recording
    Streaming --> SessionComplete: Normal Exit
    Streaming --> ConnectionLost: Recorder Down
    
    ConnectionLost --> SessionTerminated: enforceRecorder=true
    ConnectionLost --> ContinueUnrecorded: enforceRecorder=false
    
    NoRecording --> SessionComplete
    SessionAllowed --> SessionComplete
    ContinueUnrecorded --> SessionComplete
    SessionComplete --> [*]
    SessionRejected --> [*]
    SessionTerminated --> [*]
  </pre></div><style>.mermaid-wrapper{background:#2a2a2a;border-radius:8px;padding:2rem;margin:1rem 0;overflow-x:auto}.mermaid{text-align:center;background:0 0}.mermaid svg{max-width:100%;height:auto}</style><h2 id=customer-facing-overview>Customer-Facing Overview</h2><div class=mermaid-wrapper><pre class=mermaid>graph LR
    subgraph "Your Organization"
        subgraph "Users"
            U1[üë§ Developer]
            U2[üë§ Admin]
            U3[üë§ Support]
        end
        
        subgraph "Your Servers"
            S1[üñ•Ô∏è Production Server]
            S2[üñ•Ô∏è Database Server]
            S3[üñ•Ô∏è Web Server]
        end
        
        subgraph "Your Recording Infrastructure"
            R[üìπ Recorder Node]
            ST[(üíæ Storage)]
            R --> ST
        end
    end
    
    U1 & U2 & U3 -.->|üîê Secure SSH| S1 & S2 & S3
    S1 & S2 & S3 -->|üìù Session Recording| R
    
    subgraph "Benefits"
        B1[‚úÖ Compliance]
        B2[üîç Audit Trail]
        B3[üõ°Ô∏è Security]
        B4[üéØ Troubleshooting]
    end
    
    ST -.-> B1 & B2 & B3 & B4
    
    style U1 fill:#1976d2,stroke:#000,stroke-width:2px,color:#fff
    style U2 fill:#1976d2,stroke:#000,stroke-width:2px,color:#fff
    style U3 fill:#1976d2,stroke:#000,stroke-width:2px,color:#fff
    style R fill:#388e3c,stroke:#000,stroke-width:2px,color:#fff
    style ST fill:#f57c00,stroke:#000,stroke-width:2px,color:#fff
    style B1 fill:#388e3c,stroke:#fff,stroke-width:2px,color:#fff
    style B2 fill:#388e3c,stroke:#fff,stroke-width:2px,color:#fff
    style B3 fill:#388e3c,stroke:#fff,stroke-width:2px,color:#fff
    style B4 fill:#388e3c,stroke:#fff,stroke-width:2px,color:#fff
  </pre></div><style>.mermaid-wrapper{background:#2a2a2a;border-radius:8px;padding:2rem;margin:1rem 0;overflow-x:auto}.mermaid{text-align:center;background:0 0}.mermaid svg{max-width:100%;height:auto}</style><h2 id=how-session-recording-works-simplified>How Session Recording Works (Simplified)</h2><div class=mermaid-wrapper><pre class=mermaid>graph TD
    A[1. User connects via SSH] --> B[2. System checks policy]
    B --> C{Recording enabled?}
    C -->|Yes| D[3. Start recording session]
    C -->|No| E[Regular SSH session]
    
    D --> F[4. Capture terminal output]
    F --> G[5. Stream to recorder]
    G --> H[6. Save to storage]
    H --> I[7. Available for review]
    
    style A fill:#1976d2,stroke:#000,stroke-width:2px,color:#fff
    style D fill:#388e3c,stroke:#000,stroke-width:2px,color:#fff
    style G fill:#f57c00,stroke:#000,stroke-width:2px,color:#fff
    style I fill:#7b1fa2,stroke:#000,stroke-width:2px,color:#fff
  </pre></div><style>.mermaid-wrapper{background:#2a2a2a;border-radius:8px;padding:2rem;margin:1rem 0;overflow-x:auto}.mermaid{text-align:center;background:0 0}.mermaid svg{max-width:100%;height:auto}</style><h2 id=setting-up-recording-3-easy-steps>Setting Up Recording (3 Easy Steps)</h2><div class=mermaid-wrapper><pre class=mermaid>graph LR
    subgraph "Step 1: Deploy Recorder"
        D1[üê≥ Docker Container]
        D2[‚ò∏Ô∏è Kubernetes]
        D3[üñ•Ô∏è VM/Server]
        D1 & D2 & D3 --> R1[Recorder Running]
    end
    
    subgraph "Step 2: Configure Storage"
        R1 --> S1[üíæ Local Disk]
        R1 --> S2[‚òÅÔ∏è AWS S3]
        R1 --> S3[üåê Other S3]
    end
    
    subgraph "Step 3: Update ACL Policy"
        P[üìã ACL Policy] --> |Define| WHO[Who gets recorded]
        P --> |Define| WHERE[Which servers]
        P --> |Define| HOW[Storage location]
    end
    
    style R1 fill:#388e3c,stroke:#000,stroke-width:2px,color:#fff
    style P fill:#1976d2,stroke:#000,stroke-width:2px,color:#fff
  </pre></div><style>.mermaid-wrapper{background:#2a2a2a;border-radius:8px;padding:2rem;margin:1rem 0;overflow-x:auto}.mermaid{text-align:center;background:0 0}.mermaid svg{max-width:100%;height:auto}</style><h2 id=privacy--security-guarantees>Privacy & Security Guarantees</h2><div class=mermaid-wrapper><pre class=mermaid>graph TD
    subgraph "What We See"
        T1[‚ùå Nothing]
        T2[Your data never leaves your network]
    end
    
    subgraph "What You Control"
        Y1[‚úÖ All recordings]
        Y2[‚úÖ Storage location]
        Y3[‚úÖ Access policies]
        Y4[‚úÖ Retention rules]
    end
    
    subgraph "Security Features"
        S1[üîê End-to-end encrypted]
        S2[üõ°Ô∏è Zero-trust access]
        S3[üìù Audit logging]
        S4[üö´ No passwords recorded]
    end
    
    style T1 fill:#d32f2f,stroke:#000,stroke-width:2px,color:#fff
    style Y1 fill:#388e3c,stroke:#000,stroke-width:2px,color:#fff
    style Y2 fill:#388e3c,stroke:#000,stroke-width:2px,color:#fff
    style Y3 fill:#388e3c,stroke:#000,stroke-width:2px,color:#fff
    style Y4 fill:#388e3c,stroke:#000,stroke-width:2px,color:#fff
  </pre></div><style>.mermaid-wrapper{background:#2a2a2a;border-radius:8px;padding:2rem;margin:1rem 0;overflow-x:auto}.mermaid{text-align:center;background:0 0}.mermaid svg{max-width:100%;height:auto}</style><h2 id=common-use-cases>Common Use Cases</h2><div class=mermaid-wrapper><pre class=mermaid>graph TD
    subgraph "Compliance & Audit"
        C1[üìä SOC2/ISO27001]
        C2[üèõÔ∏è Regulatory Requirements]
        C3[üìã Internal Policies]
    end
    
    subgraph "Security Operations"
        S1[üîç Incident Investigation]
        S2[üö® Threat Detection]
        S3[üëÄ Activity Monitoring]
    end
    
    subgraph "Operations & Support"
        O1[üêõ Troubleshooting]
        O2[üìö Training & Documentation]
        O3[ü§ù Vendor Support]
    end
    
    R[Session Recordings] --> C1 & C2 & C3
    R --> S1 & S2 & S3
    R --> O1 & O2 & O3
    
    style R fill:#388e3c,stroke:#000,stroke-width:2px,color:#fff
    style C1 fill:#1976d2,stroke:#fff,stroke-width:2px,color:#fff
    style S1 fill:#f57c00,stroke:#fff,stroke-width:2px,color:#fff
    style O1 fill:#7b1fa2,stroke:#fff,stroke-width:2px,color:#fff
  </pre></div><style>.mermaid-wrapper{background:#2a2a2a;border-radius:8px;padding:2rem;margin:1rem 0;overflow-x:auto}.mermaid{text-align:center;background:0 0}.mermaid svg{max-width:100%;height:auto}</style><h2 id=key-features>Key Features</h2><ul><li><strong>End-to-End Encryption</strong>: All recordings streamed over WireGuard-encrypted tailnet connections</li><li><strong>Privacy by Design</strong>: Recordings stored on user-controlled infrastructure, never visible to Tailscale</li><li><strong>Flexible Storage</strong>: Support for local filesystem or S3-compatible object storage</li><li><strong>High Availability</strong>: Multiple recorder nodes with automatic failover</li><li><strong>Compliance Ready</strong>: Asciinema format allows searching and auditing of sessions</li><li><strong>Access Control</strong>: Fine-grained ACL policies determine which sessions are recorded</li><li><strong>Fail-Safe Options</strong>: Configurable behavior when recording infrastructure is unavailable</li></ul></div></article><style>.diagram-single{max-width:1200px;margin:0 auto;padding:2rem}.diagram-header{margin-bottom:2rem;text-align:center}.diagram-header h1{font-size:2.5rem;margin-bottom:1rem}.description{font-size:1.2rem;color:var(--text-secondary);margin-bottom:1rem}.metadata{display:flex;justify-content:center;align-items:center;gap:2rem;color:var(--text-secondary);font-size:.9rem}.tags{display:flex;gap:.5rem}.tag{background:var(--bg-secondary);padding:.25rem .75rem;border-radius:9999px;text-decoration:none;color:var(--text-secondary);transition:all .3s}.tag:hover{background:var(--accent);color:#fff}.diagram-container{background:var(--bg-secondary);border-radius:8px;padding:2rem;margin:2rem 0;overflow:auto}.svg-wrapper{display:flex;justify-content:center;align-items:center;min-height:400px}.svg-wrapper svg{max-width:100%;height:auto}.diagram-description{margin-top:2rem;font-size:1.1rem;line-height:1.8}</style></main><script type=module>
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ 
      startOnLoad: true,
      theme: 'dark',
      themeVariables: {
        primaryColor: '#1a1a1a',
        primaryTextColor: '#ffffff',
        primaryBorderColor: '#ffffff',
        lineColor: '#ffffff',
        secondaryColor: '#2196f3',
        tertiaryColor: '#4caf50',
        background: '#1a1a1a',
        mainBkg: '#2a2a2a',
        secondBkg: '#2196f3',
        tertiaryBkg: '#4caf50',
        secondaryBorderColor: '#ffffff',
        tertiaryBorderColor: '#ffffff',
        secondaryTextColor: '#ffffff',
        tertiaryTextColor: '#ffffff',
        edgeLabelBackground: '#2a2a2a',
        nodeTextColor: '#ffffff',
        textColor: '#ffffff',
        titleColor: '#ffffff',
        labelTextColor: '#ffffff',
        actorBorder: '#ffffff',
        actorBkg: '#2a2a2a',
        actorTextColor: '#ffffff',
        actorLineColor: '#ffffff',
        signalColor: '#ffffff',
        signalTextColor: '#ffffff',
        labelBoxBkgColor: '#2a2a2a',
        labelBoxBorderColor: '#ffffff',
        noteBkgColor: '#3a3a3a',
        noteTextColor: '#ffffff',
        noteBorderColor: '#ffffff',
        activationBorderColor: '#ffffff',
        activationBkgColor: '#3a3a3a',
        sequenceNumberColor: '#000000',
        fontFamily: 'Inter, system-ui, -apple-system, sans-serif',
        fontSize: '16px',
        darkMode: true,
        flowchart: {
          htmlLabels: true,
          curve: 'basis',
          rankSpacing: 50,
          nodeSpacing: 30,
          padding: 15,
          useMaxWidth: true
        }
      }
    });
  </script></body></html>